<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Tra C·ª©u Xe H∆°i</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .car-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        h1 {
            color: #333;
            font-size: 36px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 18px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .filters-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .results-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        input:focus, select:focus {
            border-color: #007bff;
            background: white;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        button {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .search-results {
            margin-top: 20px;
        }

        .results-count {
            margin-bottom: 15px;
            font-weight: 600;
            color: #555;
        }

        .car-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .car-card {
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .car-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .car-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .car-brand {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .car-year {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .car-model {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .car-price {
            font-size: 20px;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 15px;
        }

        .car-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 14px;
        }

        .car-detail {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .car-color {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e1e5e9;
            font-size: 13px;
            color: #666;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="car-icon">üöó</div>
            <h1>H·ªÜ TH·ªêNG TRA C·ª®U XE H∆†I</h1>
            <p class="subtitle">Database 70+ m·∫´u xe - T√¨m ki·∫øm th√¥ng tin chi ti·∫øt</p>
        </div>

        <div class="main-content">
            <!-- B·ªô l·ªçc t√¨m ki·∫øm -->
            <div class="filters-section">
                <h2 class="section-title">üîç T√åM KI·∫æM</h2>

                <div class="form-group">
                    <label for="brand">H√£ng xe:</label>
                    <select id="brand">
                        <option value="">T·∫•t c·∫£ h√£ng xe</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="model">D√≤ng xe:</label>
                    <input type="text" id="model" placeholder="Nh·∫≠p t√™n d√≤ng xe...">
                </div>

                <div class="form-group">
                    <label for="min_year">NƒÉm s·∫£n xu·∫•t t·ª´:</label>
                    <input type="number" id="min_year" min="2000" max="2024" value="2018">
                </div>

                <div class="form-group">
                    <label for="max_year">ƒê·∫øn nƒÉm:</label>
                    <input type="number" id="max_year" min="2000" max="2024" value="2024">
                </div>

                <div class="form-group">
                    <label for="fuel_type">Lo·∫°i nhi√™n li·ªáu:</label>
                    <select id="fuel_type">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="XƒÉng">XƒÉng</option>
                        <option value="D·∫ßu">D·∫ßu</option>
                        <option value="ƒêi·ªán">ƒêi·ªán</option>
                    </select>
                </div>

                <button onclick="searchCars()" id="searchBtn">
                    üîç T√åM KI·∫æM
                </button>
            </div>

            <!-- K·∫øt qu·∫£ t√¨m ki·∫øm -->
            <div class="results-section">
                <h2 class="section-title">üìä K·∫æT QU·∫¢ TRA C·ª®U</h2>

                <div class="stats" id="systemStats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalCars">-</div>
                        <div class="stat-label">T·ªîNG S·ªê XE</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalBrands">-</div>
                        <div class="stat-label">H√ÉNG XE</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalModels">-</div>
                        <div class="stat-label">M·∫™U XE</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avgPrice">-</div>
                        <div class="stat-label">GI√Å TRUNG B√åNH</div>
                    </div>
                </div>

                <div class="search-results">
                    <div class="results-count" id="resultsCount">
                        Nh·∫≠p ti√™u ch√≠ v√† nh·∫•n T√åM KI·∫æM ƒë·ªÉ xem k·∫øt qu·∫£
                    </div>

                    <div class="car-grid" id="carResults">
                        <!-- K·∫øt qu·∫£ t√¨m ki·∫øm s·∫Ω hi·ªÉn th·ªã here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load danh s√°ch brands khi trang t·∫£i
        document.addEventListener('DOMContentLoaded', function() {
            loadBrands();
            loadSystemStats();
        });

        // Load danh s√°ch h√£ng xe
        function loadBrands() {
            fetch('/api/brands')
                .then(response => response.json())
                .then(data => {
                    const brandSelect = document.getElementById('brand');
                    brandSelect.innerHTML = '<option value="">T·∫•t c·∫£ h√£ng xe</option>';

                    data.brands.forEach(brand => {
                        const option = document.createElement('option');
                        option.value = brand;
                        option.textContent = brand;
                        brandSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('L·ªói load brands:', error);
                });
        }

        // Load th·ªëng k√™ h·ªá th·ªëng
        function loadSystemStats() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('totalCars').textContent = data.total_cars;
                    document.getElementById('totalBrands').textContent = data.total_brands;
                    document.getElementById('totalModels').textContent = data.total_models;
                    document.getElementById('avgPrice').textContent = data.avg_price;
                })
                .catch(error => {
                    console.error('L·ªói load stats:', error);
                });
        }

        // T√¨m ki·∫øm xe
        function searchCars() {
            const searchBtn = document.getElementById('searchBtn');
            const resultsDiv = document.getElementById('carResults');
            const countDiv = document.getElementById('resultsCount');

            // Hi·ªÉn th·ªã loading
            searchBtn.innerHTML = '<span class="loading"></span> ƒêANG T√åM KI·∫æM...';
            searchBtn.disabled = true;

            // L·∫•y gi√° tr·ªã t·ª´ form
            const filters = {
                brand: document.getElementById('brand').value,
                model: document.getElementById('model').value,
                min_year: parseInt(document.getElementById('min_year').value) || 2000,
                max_year: parseInt(document.getElementById('max_year').value) || 2024,
                fuel_type: document.getElementById('fuel_type').value
            };

            fetch('/api/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(filters)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.results.length > 0) {
                        countDiv.innerHTML = `üìä T√¨m th·∫•y <strong>${data.count}</strong> xe ph√π h·ª£p`;
                        resultsDiv.innerHTML = data.results.map(car => `
                            <div class="car-card">
                                <div class="car-header">
                                    <div class="car-brand">${car.brand}</div>
                                    <div class="car-year">${car.year}</div>
                                </div>
                                <div class="car-model">${car.model}</div>
                                <div class="car-price">${car.price}</div>
                                <div class="car-details">
                                    <div class="car-detail">‚öôÔ∏è ${car.engine_volume}</div>
                                    <div class="car-detail">‚õΩ ${car.fuel_type}</div>
                                    <div class="car-detail">üîß ${car.transmission}</div>
                                    <div class="car-detail">üõ£Ô∏è ${car.km_driven}</div>
                                </div>
                                <div class="car-color">üé® M√†u: ${car.color}</div>
                            </div>
                        `).join('');
                    } else {
                        countDiv.innerHTML = '‚ùå Kh√¥ng t√¨m th·∫•y xe ph√π h·ª£p';
                        resultsDiv.innerHTML = '';
                    }
                } else {
                    countDiv.innerHTML = `‚ùå L·ªói: ${data.error}`;
                    resultsDiv.innerHTML = '';
                }
            })
            .catch(error => {
                countDiv.innerHTML = `‚ùå L·ªói k·∫øt n·ªëi: ${error}`;
                resultsDiv.innerHTML = '';
            })
            .finally(() => {
                // Kh√¥i ph·ª•c button
                searchBtn.innerHTML = 'üîç T√åM KI·∫æM';
                searchBtn.disabled = false;
            });
        }
    </script>
</body>
</html>